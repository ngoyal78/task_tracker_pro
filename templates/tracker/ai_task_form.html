{% extends 'tracker/base_generic.html' %}
{% load static %}

{% block title %}Create Task with AI{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row mb-3">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-light p-2">
          <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
          <li class="breadcrumb-item active" aria-current="page">Create Task with AI</li>
        </ol>
      </nav>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header bg-white">
      <h2 class="mb-0 text-primary">
        <i class="fas fa-robot me-2"></i>Create Task with AI
      </h2>
      <p class="text-muted mb-0">Describe your task in natural language and let AI extract the details</p>
    </div>
    <div class="card-body">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="mb-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <label for="{{ form.prompt.id_for_label }}" class="form-label">Task Description</label>
            <div class="form-text">
              {% if settings.OLLAMA_MODEL %}
                Powered by {{ settings.OLLAMA_MODEL }}
              {% else %}
                AI-assisted task creation
              {% endif %}
            </div>
          </div>
          {{ form.prompt.errors }}
          {{ form.prompt }}
          <div class="form-text">{{ form.prompt.help_text }}</div>
        </div>
        
        <div class="mb-4">
          <label for="{{ form.audio_file.id_for_label }}" class="form-label">
            <i class="fas fa-microphone me-1"></i>Voice Input
          </label>
          {{ form.audio_file.errors }}
          {{ form.audio_file }}
          <div class="form-text">{{ form.audio_file.help_text }}</div>
        </div>
        
        <hr class="my-4">
        <h5 class="mb-3">Optional Overrides</h5>
        <p class="text-muted mb-4">These fields are optional. If left blank, AI will suggest values based on your description.</p>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ form.title.id_for_label }}" class="form-label">Title</label>
            {{ form.title.errors }}
            {{ form.title }}
          </div>
          
          <div class="col-md-6 mb-3">
            <label for="{{ form.priority.id_for_label }}" class="form-label">Priority</label>
            {{ form.priority.errors }}
            {{ form.priority }}
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ form.due_date.id_for_label }}" class="form-label">Due Date</label>
            {{ form.due_date.errors }}
            {{ form.due_date }}
          </div>
          
          <div class="col-md-6 mb-3">
            <label for="{{ form.assigned_to.id_for_label }}" class="form-label">Assign To</label>
            {{ form.assigned_to.errors }}
            {{ form.assigned_to }}
            <div class="form-text">Hold Ctrl/Cmd to select multiple users</div>
          </div>
        </div>
        
        <div class="d-flex justify-content-between mt-4">
          <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
            <i class="fas fa-times me-1"></i>Cancel
          </a>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-magic me-1"></i>Generate Task
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <div class="card mt-4 shadow-sm">
    <div class="card-header bg-white">
      <h5 class="mb-0">
        <i class="fas fa-lightbulb me-2 text-warning"></i>Tips for Auto Surveyor Tasks
      </h5>
    </div>
    <div class="card-body">
      <ul class="mb-3">
        <li>Include vehicle identification (VIN, make, model) when available</li>
        <li>Specify the location of the vehicle</li>
        <li>Describe the damage clearly and its severity</li>
        <li>Mention any deadlines or time constraints</li>
        <li>Indicate priority level for urgent cases</li>
        <li>Specify who should be assigned to the task</li>
        <li>Example: "Survey completed for VIN WB02A1234 near Indore. Minor rear damage. Assign to Ramesh. Due tomorrow."</li>
      </ul>
      <div class="alert alert-info">
        <strong>Task Categories:</strong>
        <ul class="mb-0 mt-1">
          <li>Initial Survey (Category 1)</li>
          <li>Damage Assessment (Category 2)</li>
          <li>Claims Processing (Category 3)</li>
          <li>Final Inspection (Category 4)</li>
        </ul>
      </div>
      <a href="{% static 'example_prompts.md' %}" target="_blank" class="btn btn-sm btn-outline-primary">
        <i class="fas fa-lightbulb me-1"></i>View More Example Prompts
      </a>
    </div>
  </div>
</div>

<script>
  // Add Bootstrap form classes
  document.addEventListener('DOMContentLoaded', function() {
    // Add Bootstrap classes to form elements
    document.querySelectorAll('input[type="text"], input[type="date"], select, textarea').forEach(function(el) {
      el.classList.add('form-control');
    });
    
    // Special handling for file input
    document.querySelectorAll('input[type="file"]').forEach(function(el) {
      el.classList.add('form-control');
    });
  });
</script>
{% endblock %}
